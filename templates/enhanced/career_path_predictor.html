{% extends "base.html" %}

{% block title %}AI Career Path Predictor{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="text-center mb-5">
                <h1 class="display-4 fw-bold text-primary">AI Career Path Predictor</h1>
                <p class="lead text-muted">Analyze your career trajectory and discover international opportunities with AI-powered insights</p>
            </div>

            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Career Analysis</h5>
                </div>
                <div class="card-body p-4">
                    <form id="careerPredictionForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="currentTitle" class="form-label">Current Job Title</label>
                                <input type="text" class="form-control" id="currentTitle" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="experience" class="form-label">Years of Experience</label>
                                <select class="form-select" id="experience" required>
                                    <option value="">Select experience</option>
                                    <option value="0-2">0-2 years</option>
                                    <option value="3-5">3-5 years</option>
                                    <option value="6-10">6-10 years</option>
                                    <option value="10+">10+ years</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="industry" class="form-label">Industry</label>
                                <select class="form-select" id="industry" required>
                                    <option value="">Select industry</option>
                                    <option value="technology">Technology</option>
                                    <option value="finance">Finance</option>
                                    <option value="healthcare">Healthcare</option>
                                    <option value="engineering">Engineering</option>
                                    <option value="consulting">Consulting</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="targetLocation" class="form-label">Target Location</label>
                                <select class="form-select" id="targetLocation" required>
                                    <option value="">Select target location</option>
                                    <option value="United States">United States</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Canada">Canada</option>
                                    <option value="Germany">Germany</option>
                                    <option value="Australia">Australia</option>
                                    <option value="Netherlands">Netherlands</option>
                                    <option value="Singapore">Singapore</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="currentSalary" class="form-label">Current Salary (USD)</label>
                                <input type="number" class="form-control" id="currentSalary" placeholder="75000">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="yearsAhead" class="form-label">Prediction Timeline</label>
                                <select class="form-select" id="yearsAhead">
                                    <option value="3">3 years</option>
                                    <option value="5" selected>5 years</option>
                                    <option value="10">10 years</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="skills" class="form-label">Key Skills (comma-separated)</label>
                            <textarea class="form-control" id="skills" rows="3" placeholder="Python, Machine Learning, Project Management, Leadership"></textarea>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5">
                                <i class="fas fa-crystal-ball me-2"></i>Predict Career Path
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="mt-5" style="display: none;">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-route me-2"></i>Your Career Trajectory</h5>
                            </div>
                            <div class="card-body" id="careerResults">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Opportunities</h5>
                            </div>
                            <div class="card-body" id="opportunitiesResults">
                                <!-- Opportunities will be populated here -->
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Recommendations</h5>
                            </div>
                            <div class="card-body" id="recommendationsResults">
                                <!-- Recommendations will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('careerPredictionForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        profile: {
            current_title: document.getElementById('currentTitle').value,
            experience_years: document.getElementById('experience').value,
            industry: document.getElementById('industry').value,
            current_salary: parseInt(document.getElementById('currentSalary').value) || null,
            skills: document.getElementById('skills').value.split(',').map(s => s.trim())
        },
        target_location: document.getElementById('targetLocation').value,
        years_ahead: parseInt(document.getElementById('yearsAhead').value)
    };
    
    try {
        const response = await fetch('/api/career-prediction', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
            displayResults(data);
        } else {
            alert('Error: ' + data.error);
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
});

function displayResults(data) {
    // Display career trajectory
    const careerResults = document.getElementById('careerResults');
    careerResults.innerHTML = `
        <div class="row">
            <div class="col-md-6">
                <h6><i class="fas fa-arrow-up text-success"></i> Next Role Prediction</h6>
                <p class="fw-bold">${data.career_trajectory.next_role}</p>
            </div>
            <div class="col-md-6">
                <h6><i class="fas fa-dollar-sign text-success"></i> Salary Progression</h6>
                <p class="fw-bold">$${data.career_trajectory.salary_progression.toLocaleString()}</p>
            </div>
        </div>
        <div class="mt-3">
            <h6><i class="fas fa-chart-bar text-info"></i> Market Demand</h6>
            <div class="progress mb-2">
                <div class="progress-bar" style="width: ${data.career_trajectory.market_demand}%">${data.career_trajectory.market_demand}%</div>
            </div>
        </div>
        <div class="mt-3">
            <h6><i class="fas fa-plane text-primary"></i> Relocation Readiness</h6>
            <div class="progress">
                <div class="progress-bar bg-primary" style="width: ${data.career_trajectory.relocation_readiness}%">${data.career_trajectory.relocation_readiness}%</div>
            </div>
        </div>
    `;
    
    // Display opportunities
    const opportunitiesResults = document.getElementById('opportunitiesResults');
    opportunitiesResults.innerHTML = data.opportunities.map(opp => `
        <div class="border-bottom pb-2 mb-2">
            <h6 class="mb-1">${opp.title}</h6>
            <small class="text-muted">${opp.company} - ${opp.location}</small>
            <div class="d-flex justify-content-between mt-1">
                <span class="badge bg-primary">Match: ${opp.match_score}%</span>
                ${opp.visa_sponsorship ? '<span class="badge bg-success">Visa Sponsor</span>' : ''}
            </div>
        </div>
    `).join('');
    
    // Display recommendations
    const recommendationsResults = document.getElementById('recommendationsResults');
    recommendationsResults.innerHTML = data.recommendations.map(rec => `
        <div class="alert alert-light border-start border-warning border-4 mb-2">
            <i class="fas fa-check-circle text-success me-2"></i>${rec}
        </div>
    `).join('');
    
    document.getElementById('resultsSection').style.display = 'block';
    document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
}
</script>
{% endblock %}