{% extends "base.html" %}

{% block title %}Subscription - Relocation Jobs Hub{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h1 class="text-center mb-5">
                <i class="fas fa-crown me-2"></i>Choose Your Plan
            </h1>
            
            {% if current_user.subscription_type == 'free' %}
            <div class="alert alert-info text-center mb-4">
                <h4><i class="fas fa-clock me-2"></i>Free Trial Active</h4>
                <p class="mb-0">Your free trial expires on {{ current_user.subscription_expires.strftime('%B %d, %Y') if current_user.subscription_expires else 'Unknown' }}</p>
            </div>
            {% endif %}
            
            <div class="row">
                <!-- Free Plan -->
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card h-100 {% if current_user.subscription_type == 'free' %}border-primary{% endif %}">
                        <div class="card-header text-center {% if current_user.subscription_type == 'free' %}bg-primary text-white{% endif %}">
                            <h4>Free Trial</h4>
                            <h2>$0<small class="fs-6">/30 days</small></h2>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>All salary tools</li>
                                <li><i class="fas fa-check text-success me-2"></i>Visa checker</li>
                                <li><i class="fas fa-check text-success me-2"></i>Cost calculator</li>
                                <li><i class="fas fa-check text-success me-2"></i>Resume optimizer</li>
                                <li><i class="fas fa-check text-success me-2"></i>Job bookmarking</li>
                                <li><i class="fas fa-check text-success me-2"></i>Application tracking</li>
                            </ul>
                            {% if current_user.subscription_type == 'free' %}
                                <button class="btn btn-outline-primary mt-auto" disabled>Current Plan</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Premium Plan -->
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card h-100 {% if current_user.subscription_type == 'premium' %}border-success{% endif %}">
                        <div class="card-header text-center {% if current_user.subscription_type == 'premium' %}bg-success text-white{% else %}bg-light{% endif %}">
                            <h4>Premium</h4>
                            <h2>$29<small class="fs-6">/month</small></h2>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Everything in Free</li>
                                <li><i class="fas fa-check text-success me-2"></i>Priority support</li>
                                <li><i class="fas fa-check text-success me-2"></i>Advanced analytics</li>
                                <li><i class="fas fa-check text-success me-2"></i>Unlimited bookmarks</li>
                                <li><i class="fas fa-check text-success me-2"></i>Email alerts</li>
                                <li><i class="fas fa-check text-success me-2"></i>Resume templates</li>
                            </ul>
                            {% if current_user.subscription_type == 'premium' %}
                                <button class="btn btn-outline-success mt-auto" disabled>Current Plan</button>
                            {% else %}
                                <button class="btn btn-success mt-auto" onclick="upgradePlan('premium')">
                                    Choose Premium
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Family Plan -->
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card h-100 {% if current_user.subscription_type == 'family' %}border-warning{% endif %}">
                        <div class="card-header text-center {% if current_user.subscription_type == 'family' %}bg-warning text-dark{% else %}bg-light{% endif %}">
                            <h4>Family</h4>
                            <h2>$49<small class="fs-6">/month</small></h2>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Everything in Premium</li>
                                <li><i class="fas fa-check text-success me-2"></i>Up to 4 family members</li>
                                <li><i class="fas fa-check text-success me-2"></i>Shared bookmarks</li>
                                <li><i class="fas fa-check text-success me-2"></i>Family visa guidance</li>
                                <li><i class="fas fa-check text-success me-2"></i>Joint applications</li>
                                <li><i class="fas fa-check text-success me-2"></i>Relocation planning</li>
                            </ul>
                            {% if current_user.subscription_type == 'family' %}
                                <button class="btn btn-outline-warning mt-auto" disabled>Current Plan</button>
                            {% else %}
                                <button class="btn btn-warning mt-auto" onclick="upgradePlan('family')">
                                    Choose Family
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Enterprise Plan -->
                <div class="col-md-6 col-lg-3 mb-4">
                    <div class="card h-100 {% if current_user.subscription_type == 'enterprise' %}border-danger{% endif %}">
                        <div class="card-header text-center {% if current_user.subscription_type == 'enterprise' %}bg-danger text-white{% else %}bg-light{% endif %}">
                            <h4>Enterprise</h4>
                            <h2>$99<small class="fs-6">/month</small></h2>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>Everything in Family</li>
                                <li><i class="fas fa-check text-success me-2"></i>Unlimited team members</li>
                                <li><i class="fas fa-check text-success me-2"></i>Custom integrations</li>
                                <li><i class="fas fa-check text-success me-2"></i>Dedicated support</li>
                                <li><i class="fas fa-check text-success me-2"></i>API access</li>
                                <li><i class="fas fa-check text-success me-2"></i>White-label options</li>
                            </ul>
                            {% if current_user.subscription_type == 'enterprise' %}
                                <button class="btn btn-outline-danger mt-auto" disabled>Current Plan</button>
                            {% else %}
                                <button class="btn btn-danger mt-auto" onclick="upgradePlan('enterprise')">
                                    Choose Enterprise
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function upgradePlan(plan) {
    try {
        const response = await fetch('/dashboard/upgrade', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ plan: plan })
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert(`Successfully upgraded to ${plan} plan!`);
            location.reload();
        } else {
            alert('Upgrade failed: ' + result.error);
        }
    } catch (error) {
        console.error('Error upgrading plan:', error);
        alert('An error occurred while upgrading. Please try again.');
    }
}
</script>
{% endblock %}